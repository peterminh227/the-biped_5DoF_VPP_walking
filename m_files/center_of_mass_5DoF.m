function [cmh,cmv,dcmh,dcmv,acmh,acmv] = center_of_mass_5DoF(x,ddq)

%2016 Version: Peter Minh
%05-Dec-2016 17:03:23

modelP;

[nn,mm] = size(x);

if nn ~= 1 & mm ~= 1
  cmh = (M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + M4.*MY4.*cos(x(:,2) + ...
         x(:,4) + x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.* ...
        L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + ...
         x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.* ...
        MZ4.*sin(x(:,2) + x(:,4) + x(:,5)) + M3.*MY3.*cos(x(:,1) + ...
         x(:,5)) + M3.*MY3.*cos(x(:,2) + x(:,5)) + L3.*M1.*sin(x(:,1) + ...
         x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + L3.*M4.*sin(x(:,1) + ...
         x(:,5)) - L3.*M4.*sin(x(:,2) + x(:,5)) - M3.*MZ3.*sin(x(:,1) + ...
         x(:,5)) - M3.*MZ3.*sin(x(:,2) + x(:,5)) + M1.*MY1.*cos(x(:,5)) - ...
         M1.*MZ1.*sin(x(:,5)))./(M1 + 2.*M3 + 2.*M4);
  cmv = (M4.*MZ4.*cos(x(:,1) + x(:,3) + x(:,5)) - 2.*L4.*M3.*cos(x(:,1) + ...
         x(:,3) + x(:,5)) - 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - ...
         L4.*M1.*cos(x(:,1) + x(:,3) + x(:,5)) + M4.*MZ4.*cos(x(:,2) + ...
         x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,1) + x(:,3) + x(:,5)) + M4.* ...
        MY4.*sin(x(:,2) + x(:,4) + x(:,5)) - L3.*M1.*cos(x(:,1) + ...
         x(:,5)) - 2.*L3.*M3.*cos(x(:,1) + x(:,5)) - L3.*M4.*cos(x(:,1) + ...
         x(:,5)) + L3.*M4.*cos(x(:,2) + x(:,5)) + M3.*MZ3.*cos(x(:,1) + ...
         x(:,5)) + M3.*MZ3.*cos(x(:,2) + x(:,5)) + M3.*MY3.*sin(x(:,1) + ...
         x(:,5)) + M3.*MY3.*sin(x(:,2) + x(:,5)) + M1.*MZ1.*cos(x(:,5)) + ...
         M1.*MY1.*sin(x(:,5)))./(M1 + 2.*M3 + 2.*M4);
  dcmh = (x(:,6).*(L4.*M1.*cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.* ...
         cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + x(:,3) + ...
          x(:,5)) - M4.*MZ4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MY4.* ...
         sin(x(:,1) + x(:,3) + x(:,5)) + L3.*M1.*cos(x(:,1) + x(:,5)) + ...
          2.*L3.*M3.*cos(x(:,1) + x(:,5)) + L3.*M4.*cos(x(:,1) + x(:,5)) - ...
          M3.*MZ3.*cos(x(:,1) + x(:,5)) - M3.*MY3.*sin(x(:,1) + ...
          x(:,5))))./(M1 + 2.*M3 + 2.*M4) - (x(:,7).*(M4.*MZ4.* ...
         cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
          x(:,5)) + L3.*M4.*cos(x(:,2) + x(:,5)) + M3.*MZ3.*cos(x(:,2) + ...
          x(:,5)) + M3.*MY3.*sin(x(:,2) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
         M4) - (x(:,9).*(M4.*MZ4.*cos(x(:,2) + x(:,4) + x(:,5)) + M4.* ...
         MY4.*sin(x(:,2) + x(:,4) + x(:,5))))./(M1 + 2.*M3 + 2.*M4) - ...
          (x(:,10).*(M4.*MZ4.*cos(x(:,1) + x(:,3) + x(:,5)) - 2.*L4.*M3.* ...
         cos(x(:,1) + x(:,3) + x(:,5)) - 2.*L4.*M4.*cos(x(:,1) + x(:,3) + ...
          x(:,5)) - L4.*M1.*cos(x(:,1) + x(:,3) + x(:,5)) + M4.*MZ4.* ...
         cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,1) + x(:,3) + ...
          x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + x(:,5)) - L3.*M1.* ...
         cos(x(:,1) + x(:,5)) - 2.*L3.*M3.*cos(x(:,1) + x(:,5)) - L3.*M4.* ...
         cos(x(:,1) + x(:,5)) + L3.*M4.*cos(x(:,2) + x(:,5)) + M3.*MZ3.* ...
         cos(x(:,1) + x(:,5)) + M3.*MZ3.*cos(x(:,2) + x(:,5)) + M3.*MY3.* ...
         sin(x(:,1) + x(:,5)) + M3.*MY3.*sin(x(:,2) + x(:,5)) + M1.*MZ1.* ...
         cos(x(:,5)) + M1.*MY1.*sin(x(:,5))))./(M1 + 2.*M3 + 2.*M4) + ...
          (x(:,8).*(L4.*M1.*cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.* ...
         cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + x(:,3) + ...
          x(:,5)) - M4.*MZ4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MY4.* ...
         sin(x(:,1) + x(:,3) + x(:,5))))./(M1 + 2.*M3 + 2.*M4);
  dcmv = (x(:,8).*(M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.* ...
         sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + ...
          x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
         sin(x(:,1) + x(:,3) + x(:,5))))./(M1 + 2.*M3 + 2.*M4) + ...
          (x(:,10).*(M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + M4.*MY4.* ...
         cos(x(:,2) + x(:,4) + x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + ...
          x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.* ...
         sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + ...
          x(:,5)) - M4.*MZ4.*sin(x(:,2) + x(:,4) + x(:,5)) + M3.*MY3.* ...
         cos(x(:,1) + x(:,5)) + M3.*MY3.*cos(x(:,2) + x(:,5)) + L3.*M1.* ...
         sin(x(:,1) + x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + L3.*M4.* ...
         sin(x(:,1) + x(:,5)) - L3.*M4.*sin(x(:,2) + x(:,5)) - M3.*MZ3.* ...
         sin(x(:,1) + x(:,5)) - M3.*MZ3.*sin(x(:,2) + x(:,5)) + M1.*MY1.* ...
         cos(x(:,5)) - M1.*MZ1.*sin(x(:,5))))./(M1 + 2.*M3 + 2.*M4) + ...
          (x(:,6).*(M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.* ...
         sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + ...
          x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
         sin(x(:,1) + x(:,3) + x(:,5)) + M3.*MY3.*cos(x(:,1) + x(:,5)) + ...
          L3.*M1.*sin(x(:,1) + x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + ...
          L3.*M4.*sin(x(:,1) + x(:,5)) - M3.*MZ3.*sin(x(:,1) + ...
          x(:,5))))./(M1 + 2.*M3 + 2.*M4) - (x(:,7).*(M4.*MZ4.* ...
         sin(x(:,2) + x(:,4) + x(:,5)) - M4.*MY4.*cos(x(:,2) + x(:,4) + ...
          x(:,5)) - M3.*MY3.*cos(x(:,2) + x(:,5)) + L3.*M4.*sin(x(:,2) + ...
          x(:,5)) + M3.*MZ3.*sin(x(:,2) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
         M4) + (x(:,9).*(M4.*MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - M4.* ...
         MZ4.*sin(x(:,2) + x(:,4) + x(:,5))))./(M1 + 2.*M3 + 2.*M4);
  if nargin > 1
    acmh = x(:,7).*((x(:,10).*(M4.*MZ4.*sin(x(:,2) + x(:,4) + x(:,5)) - M4.* ...
           MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - M3.*MY3.*cos(x(:,2) + ...
            x(:,5)) + L3.*M4.*sin(x(:,2) + x(:,5)) + M3.*MZ3.*sin(x(:,2) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,7).*(M4.*MZ4.* ...
           sin(x(:,2) + x(:,4) + x(:,5)) - M4.*MY4.*cos(x(:,2) + x(:,4) + ...
            x(:,5)) - M3.*MY3.*cos(x(:,2) + x(:,5)) + L3.*M4.*sin(x(:,2) + ...
            x(:,5)) + M3.*MZ3.*sin(x(:,2) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
           M4) - (x(:,9).*(M4.*MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - M4.* ...
           MZ4.*sin(x(:,2) + x(:,4) + x(:,5))))./(M1 + 2.*M3 + 2.*M4)) - ...
            x(:,6).*((x(:,8).*(M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + L4.* ...
           M1.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + ...
            x(:,3) + x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + x(:,3) + x(:,5)) - ...
            M4.*MZ4.*sin(x(:,1) + x(:,3) + x(:,5))))./(M1 + 2.*M3 + 2.*M4) + ...
            (x(:,10).*(M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) + M3.*MY3.*cos(x(:,1) + x(:,5)) + ...
            L3.*M1.*sin(x(:,1) + x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + ...
            L3.*M4.*sin(x(:,1) + x(:,5)) - M3.*MZ3.*sin(x(:,1) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,6).*(M4.*MY4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + M3.*MY3.*cos(x(:,1) + x(:,5)) + L3.*M1.*sin(x(:,1) + ...
            x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + L3.*M4.*sin(x(:,1) + ...
            x(:,5)) - M3.*MZ3.*sin(x(:,1) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
           M4)) - x(:,10).*((x(:,8).*(M4.*MY4.*cos(x(:,1) + x(:,3) + ...
            x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + x(:,5))))./(M1 + 2.* ...
           M3 + 2.*M4) + (x(:,10).*(M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + ...
            M4.*MY4.*cos(x(:,2) + x(:,4) + x(:,5)) + L4.*M1.*sin(x(:,1) + ...
            x(:,3) + x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + ...
            2.*L4.*M4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + ...
            x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,2) + x(:,4) + x(:,5)) + M3.* ...
           MY3.*cos(x(:,1) + x(:,5)) + M3.*MY3.*cos(x(:,2) + x(:,5)) + L3.* ...
           M1.*sin(x(:,1) + x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + L3.* ...
           M4.*sin(x(:,1) + x(:,5)) - L3.*M4.*sin(x(:,2) + x(:,5)) - M3.* ...
           MZ3.*sin(x(:,1) + x(:,5)) - M3.*MZ3.*sin(x(:,2) + x(:,5)) + M1.* ...
           MY1.*cos(x(:,5)) - M1.*MZ1.*sin(x(:,5))))./(M1 + 2.*M3 + 2.*M4) + ...
            (x(:,6).*(M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) + M3.*MY3.*cos(x(:,1) + x(:,5)) + ...
            L3.*M1.*sin(x(:,1) + x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + ...
            L3.*M4.*sin(x(:,1) + x(:,5)) - M3.*MZ3.*sin(x(:,1) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) - (x(:,7).*(M4.*MZ4.* ...
           sin(x(:,2) + x(:,4) + x(:,5)) - M4.*MY4.*cos(x(:,2) + x(:,4) + ...
            x(:,5)) - M3.*MY3.*cos(x(:,2) + x(:,5)) + L3.*M4.*sin(x(:,2) + ...
            x(:,5)) + M3.*MZ3.*sin(x(:,2) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
           M4) + (x(:,9).*(M4.*MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - M4.* ...
           MZ4.*sin(x(:,2) + x(:,4) + x(:,5))))./(M1 + 2.*M3 + 2.*M4)) - ...
            x(:,9).*((x(:,10).*(M4.*MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - ...
            M4.*MZ4.*sin(x(:,2) + x(:,4) + x(:,5))))./(M1 + 2.*M3 + 2.*M4) + ...
            (x(:,7).*(M4.*MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - M4.*MZ4.* ...
           sin(x(:,2) + x(:,4) + x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,9).* ...
           (M4.*MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - M4.*MZ4.*sin(x(:,2) + ...
            x(:,4) + x(:,5))))./(M1 + 2.*M3 + 2.*M4)) - x(:,8).*((x(:,10).* ...
           (M4.*MY4.*cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.*sin(x(:,1) + ...
            x(:,3) + x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + ...
            2.*L4.*M4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + ...
            x(:,3) + x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,6).*(M4.*MY4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,8).*(M4.*MY4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4)) + (ddq(:,1).*(L4.*M1.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + L3.*M1.*cos(x(:,1) + x(:,5)) + 2.*L3.*M3.*cos(x(:,1) + ...
            x(:,5)) + L3.*M4.*cos(x(:,1) + x(:,5)) - M3.*MZ3.*cos(x(:,1) + ...
            x(:,5)) - M3.*MY3.*sin(x(:,1) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
           M4) - (ddq(:,2).*(M4.*MZ4.*cos(x(:,2) + x(:,4) + x(:,5)) + M4.* ...
           MY4.*sin(x(:,2) + x(:,4) + x(:,5)) + L3.*M4.*cos(x(:,2) + ...
            x(:,5)) + M3.*MZ3.*cos(x(:,2) + x(:,5)) + M3.*MY3.*sin(x(:,2) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) - (ddq(:,4).*(M4.*MZ4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) - (ddq(:,5).*(M4.*MZ4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) - 2.*L4.*M3.*cos(x(:,1) + x(:,3) + ...
            x(:,5)) - 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - L4.*M1.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + M4.*MZ4.*cos(x(:,2) + x(:,4) + ...
            x(:,5)) + M4.*MY4.*sin(x(:,1) + x(:,3) + x(:,5)) + M4.*MY4.* ...
           sin(x(:,2) + x(:,4) + x(:,5)) - L3.*M1.*cos(x(:,1) + x(:,5)) - ...
            2.*L3.*M3.*cos(x(:,1) + x(:,5)) - L3.*M4.*cos(x(:,1) + x(:,5)) + ...
            L3.*M4.*cos(x(:,2) + x(:,5)) + M3.*MZ3.*cos(x(:,1) + x(:,5)) + ...
            M3.*MZ3.*cos(x(:,2) + x(:,5)) + M3.*MY3.*sin(x(:,1) + x(:,5)) + ...
            M3.*MY3.*sin(x(:,2) + x(:,5)) + M1.*MZ1.*cos(x(:,5)) + M1.*MY1.* ...
           sin(x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (ddq(:,3).*(L4.*M1.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4);
    acmv = x(:,6).*((x(:,10).*(L4.*M1.*cos(x(:,1) + x(:,3) + x(:,5)) + 2.* ...
           L4.*M3.*cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) - M4.*MZ4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.* ...
           MY4.*sin(x(:,1) + x(:,3) + x(:,5)) + L3.*M1.*cos(x(:,1) + ...
            x(:,5)) + 2.*L3.*M3.*cos(x(:,1) + x(:,5)) + L3.*M4.*cos(x(:,1) + ...
            x(:,5)) - M3.*MZ3.*cos(x(:,1) + x(:,5)) - M3.*MY3.*sin(x(:,1) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,6).*(L4.*M1.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + x(:,3) + x(:,5)) + ...
            2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + x(:,3) + x(:,5)) + L3.* ...
           M1.*cos(x(:,1) + x(:,5)) + 2.*L3.*M3.*cos(x(:,1) + x(:,5)) + L3.* ...
           M4.*cos(x(:,1) + x(:,5)) - M3.*MZ3.*cos(x(:,1) + x(:,5)) - M3.* ...
           MY3.*sin(x(:,1) + x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,8).* ...
           (L4.*M1.*cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - ...
            M4.*MZ4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + ...
            x(:,3) + x(:,5))))./(M1 + 2.*M3 + 2.*M4)) - x(:,7).*((x(:,10).* ...
           (M4.*MZ4.*cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + ...
            x(:,4) + x(:,5)) + L3.*M4.*cos(x(:,2) + x(:,5)) + M3.*MZ3.* ...
           cos(x(:,2) + x(:,5)) + M3.*MY3.*sin(x(:,2) + x(:,5))))./(M1 + 2.* ...
           M3 + 2.*M4) + (x(:,7).*(M4.*MZ4.*cos(x(:,2) + x(:,4) + x(:,5)) + ...
            M4.*MY4.*sin(x(:,2) + x(:,4) + x(:,5)) + L3.*M4.*cos(x(:,2) + ...
            x(:,5)) + M3.*MZ3.*cos(x(:,2) + x(:,5)) + M3.*MY3.*sin(x(:,2) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,9).*(M4.*MZ4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4)) - x(:,10).*((x(:,7).*(M4.*MZ4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
            x(:,5)) + L3.*M4.*cos(x(:,2) + x(:,5)) + M3.*MZ3.*cos(x(:,2) + ...
            x(:,5)) + M3.*MY3.*sin(x(:,2) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
           M4) - (x(:,6).*(L4.*M1.*cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.* ...
           M3.*cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) - M4.*MZ4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.* ...
           MY4.*sin(x(:,1) + x(:,3) + x(:,5)) + L3.*M1.*cos(x(:,1) + ...
            x(:,5)) + 2.*L3.*M3.*cos(x(:,1) + x(:,5)) + L3.*M4.*cos(x(:,1) + ...
            x(:,5)) - M3.*MZ3.*cos(x(:,1) + x(:,5)) - M3.*MY3.*sin(x(:,1) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,9).*(M4.*MZ4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,10).*(M4.*MZ4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) - 2.*L4.*M3.*cos(x(:,1) + x(:,3) + ...
            x(:,5)) - 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - L4.*M1.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + M4.*MZ4.*cos(x(:,2) + x(:,4) + ...
            x(:,5)) + M4.*MY4.*sin(x(:,1) + x(:,3) + x(:,5)) + M4.*MY4.* ...
           sin(x(:,2) + x(:,4) + x(:,5)) - L3.*M1.*cos(x(:,1) + x(:,5)) - ...
            2.*L3.*M3.*cos(x(:,1) + x(:,5)) - L3.*M4.*cos(x(:,1) + x(:,5)) + ...
            L3.*M4.*cos(x(:,2) + x(:,5)) + M3.*MZ3.*cos(x(:,1) + x(:,5)) + ...
            M3.*MZ3.*cos(x(:,2) + x(:,5)) + M3.*MY3.*sin(x(:,1) + x(:,5)) + ...
            M3.*MY3.*sin(x(:,2) + x(:,5)) + M1.*MZ1.*cos(x(:,5)) + M1.*MY1.* ...
           sin(x(:,5))))./(M1 + 2.*M3 + 2.*M4) - (x(:,8).*(L4.*M1.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4)) - x(:,9).*((x(:,10).*(M4.*MZ4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,7).*(M4.*MZ4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,9).*(M4.*MZ4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) + M4.*MY4.*sin(x(:,2) + x(:,4) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4)) + x(:,8).*((x(:,10).*(L4.*M1.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,6).*(L4.*M1.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + x(:,3) + x(:,5)) + ...
            2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (x(:,8).*(L4.*M1.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) + 2.*L4.*M3.*cos(x(:,1) + x(:,3) + x(:,5)) + ...
            2.*L4.*M4.*cos(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*cos(x(:,1) + ...
            x(:,3) + x(:,5)) - M4.*MY4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4)) + (ddq(:,3).*(M4.*MY4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (ddq(:,5).*(M4.*MY4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + M4.*MY4.*cos(x(:,2) + x(:,4) + ...
            x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M3.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.* ...
           sin(x(:,2) + x(:,4) + x(:,5)) + M3.*MY3.*cos(x(:,1) + x(:,5)) + ...
            M3.*MY3.*cos(x(:,2) + x(:,5)) + L3.*M1.*sin(x(:,1) + x(:,5)) + ...
            2.*L3.*M3.*sin(x(:,1) + x(:,5)) + L3.*M4.*sin(x(:,1) + x(:,5)) - ...
            L3.*M4.*sin(x(:,2) + x(:,5)) - M3.*MZ3.*sin(x(:,1) + x(:,5)) - ...
            M3.*MZ3.*sin(x(:,2) + x(:,5)) + M1.*MY1.*cos(x(:,5)) - M1.*MZ1.* ...
           sin(x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (ddq(:,1).*(M4.*MY4.* ...
           cos(x(:,1) + x(:,3) + x(:,5)) + L4.*M1.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + 2.*L4.*M3.*sin(x(:,1) + x(:,3) + x(:,5)) + 2.*L4.*M4.* ...
           sin(x(:,1) + x(:,3) + x(:,5)) - M4.*MZ4.*sin(x(:,1) + x(:,3) + ...
            x(:,5)) + M3.*MY3.*cos(x(:,1) + x(:,5)) + L3.*M1.*sin(x(:,1) + ...
            x(:,5)) + 2.*L3.*M3.*sin(x(:,1) + x(:,5)) + L3.*M4.*sin(x(:,1) + ...
            x(:,5)) - M3.*MZ3.*sin(x(:,1) + x(:,5))))./(M1 + 2.*M3 + 2.* ...
           M4) - (ddq(:,2).*(M4.*MZ4.*sin(x(:,2) + x(:,4) + x(:,5)) - M4.* ...
           MY4.*cos(x(:,2) + x(:,4) + x(:,5)) - M3.*MY3.*cos(x(:,2) + ...
            x(:,5)) + L3.*M4.*sin(x(:,2) + x(:,5)) + M3.*MZ3.*sin(x(:,2) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4) + (ddq(:,4).*(M4.*MY4.* ...
           cos(x(:,2) + x(:,4) + x(:,5)) - M4.*MZ4.*sin(x(:,2) + x(:,4) + ...
            x(:,5))))./(M1 + 2.*M3 + 2.*M4);
  end
else
  cmh = (M4*MY4*cos(x(1) + x(3) + x(5)) + M4*MY4*cos(x(2) + x(4) + ...
         x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2*L4*M3*sin(x(1) + ...
         x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - M4*MZ4* ...
        sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(2) + x(4) + x(5)) + M3* ...
        MY3*cos(x(1) + x(5)) + M3*MY3*cos(x(2) + x(5)) + L3*M1*sin(x(1) + ...
         x(5)) + 2*L3*M3*sin(x(1) + x(5)) + L3*M4*sin(x(1) + x(5)) - L3* ...
        M4*sin(x(2) + x(5)) - M3*MZ3*sin(x(1) + x(5)) - M3*MZ3*sin(x(2) + ...
         x(5)) + M1*MY1*cos(x(5)) - M1*MZ1*sin(x(5)))/(M1 + 2*M3 + 2*M4);
  cmv = (M4*MZ4*cos(x(1) + x(3) + x(5)) - 2*L4*M3*cos(x(1) + x(3) + ...
         x(5)) - 2*L4*M4*cos(x(1) + x(3) + x(5)) - L4*M1*cos(x(1) + ...
         x(3) + x(5)) + M4*MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4* ...
        sin(x(1) + x(3) + x(5)) + M4*MY4*sin(x(2) + x(4) + x(5)) - L3*M1* ...
        cos(x(1) + x(5)) - 2*L3*M3*cos(x(1) + x(5)) - L3*M4*cos(x(1) + ...
         x(5)) + L3*M4*cos(x(2) + x(5)) + M3*MZ3*cos(x(1) + x(5)) + M3* ...
        MZ3*cos(x(2) + x(5)) + M3*MY3*sin(x(1) + x(5)) + M3*MY3* ...
        sin(x(2) + x(5)) + M1*MZ1*cos(x(5)) + M1*MY1*sin(x(5)))/(M1 + 2* ...
        M3 + 2*M4);
  dcmh = (x(6)*(L4*M1*cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + x(3) + ...
          x(5)) + 2*L4*M4*cos(x(1) + x(3) + x(5)) - M4*MZ4*cos(x(1) + ...
          x(3) + x(5)) - M4*MY4*sin(x(1) + x(3) + x(5)) + L3*M1*cos(x(1) + ...
          x(5)) + 2*L3*M3*cos(x(1) + x(5)) + L3*M4*cos(x(1) + x(5)) - M3* ...
         MZ3*cos(x(1) + x(5)) - M3*MY3*sin(x(1) + x(5))))/(M1 + 2*M3 + 2* ...
         M4) - (x(7)*(M4*MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + ...
          x(4) + x(5)) + L3*M4*cos(x(2) + x(5)) + M3*MZ3*cos(x(2) + ...
          x(5)) + M3*MY3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) - (x(9)* ...
         (M4*MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + x(4) + ...
          x(5))))/(M1 + 2*M3 + 2*M4) - (x(10)*(M4*MZ4*cos(x(1) + x(3) + ...
          x(5)) - 2*L4*M3*cos(x(1) + x(3) + x(5)) - 2*L4*M4*cos(x(1) + ...
          x(3) + x(5)) - L4*M1*cos(x(1) + x(3) + x(5)) + M4*MZ4*cos(x(2) + ...
          x(4) + x(5)) + M4*MY4*sin(x(1) + x(3) + x(5)) + M4*MY4* ...
         sin(x(2) + x(4) + x(5)) - L3*M1*cos(x(1) + x(5)) - 2*L3*M3* ...
         cos(x(1) + x(5)) - L3*M4*cos(x(1) + x(5)) + L3*M4*cos(x(2) + ...
          x(5)) + M3*MZ3*cos(x(1) + x(5)) + M3*MZ3*cos(x(2) + x(5)) + M3* ...
         MY3*sin(x(1) + x(5)) + M3*MY3*sin(x(2) + x(5)) + M1*MZ1* ...
         cos(x(5)) + M1*MY1*sin(x(5))))/(M1 + 2*M3 + 2*M4) + (x(8)*(L4*M1* ...
         cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4* ...
         M4*cos(x(1) + x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4* ...
         MY4*sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4);
  dcmv = (x(8)*(M4*MY4*cos(x(1) + x(3) + x(5)) + L4*M1*sin(x(1) + x(3) + ...
          x(5)) + 2*L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4*M4*sin(x(1) + ...
          x(3) + x(5)) - M4*MZ4*sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2* ...
         M4) + (x(10)*(M4*MY4*cos(x(1) + x(3) + x(5)) + M4*MY4*cos(x(2) + ...
          x(4) + x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2*L4*M3* ...
         sin(x(1) + x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - M4* ...
         MZ4*sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(2) + x(4) + x(5)) + ...
          M3*MY3*cos(x(1) + x(5)) + M3*MY3*cos(x(2) + x(5)) + L3*M1* ...
         sin(x(1) + x(5)) + 2*L3*M3*sin(x(1) + x(5)) + L3*M4*sin(x(1) + ...
          x(5)) - L3*M4*sin(x(2) + x(5)) - M3*MZ3*sin(x(1) + x(5)) - M3* ...
         MZ3*sin(x(2) + x(5)) + M1*MY1*cos(x(5)) - M1*MZ1* ...
         sin(x(5))))/(M1 + 2*M3 + 2*M4) + (x(6)*(M4*MY4*cos(x(1) + x(3) + ...
          x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2*L4*M3*sin(x(1) + ...
          x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - M4*MZ4* ...
         sin(x(1) + x(3) + x(5)) + M3*MY3*cos(x(1) + x(5)) + L3*M1* ...
         sin(x(1) + x(5)) + 2*L3*M3*sin(x(1) + x(5)) + L3*M4*sin(x(1) + ...
          x(5)) - M3*MZ3*sin(x(1) + x(5))))/(M1 + 2*M3 + 2*M4) - (x(7)* ...
         (M4*MZ4*sin(x(2) + x(4) + x(5)) - M4*MY4*cos(x(2) + x(4) + ...
          x(5)) - M3*MY3*cos(x(2) + x(5)) + L3*M4*sin(x(2) + x(5)) + M3* ...
         MZ3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(9)*(M4*MY4* ...
         cos(x(2) + x(4) + x(5)) - M4*MZ4*sin(x(2) + x(4) + x(5))))/(M1 + ...
          2*M3 + 2*M4);
  if nargin > 1
    acmh = x(7)*((x(10)*(M4*MZ4*sin(x(2) + x(4) + x(5)) - M4*MY4*cos(x(2) + ...
            x(4) + x(5)) - M3*MY3*cos(x(2) + x(5)) + L3*M4*sin(x(2) + ...
            x(5)) + M3*MZ3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(7)* ...
           (M4*MZ4*sin(x(2) + x(4) + x(5)) - M4*MY4*cos(x(2) + x(4) + ...
            x(5)) - M3*MY3*cos(x(2) + x(5)) + L3*M4*sin(x(2) + x(5)) + M3* ...
           MZ3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) - (x(9)*(M4*MY4* ...
           cos(x(2) + x(4) + x(5)) - M4*MZ4*sin(x(2) + x(4) + x(5))))/(M1 + ...
            2*M3 + 2*M4)) - x(6)*((x(8)*(M4*MY4*cos(x(1) + x(3) + x(5)) + ...
            L4*M1*sin(x(1) + x(3) + x(5)) + 2*L4*M3*sin(x(1) + x(3) + ...
            x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(1) + ...
            x(3) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(10)*(M4*MY4*cos(x(1) + ...
            x(3) + x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2*L4*M3* ...
           sin(x(1) + x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - M4* ...
           MZ4*sin(x(1) + x(3) + x(5)) + M3*MY3*cos(x(1) + x(5)) + L3*M1* ...
           sin(x(1) + x(5)) + 2*L3*M3*sin(x(1) + x(5)) + L3*M4*sin(x(1) + ...
            x(5)) - M3*MZ3*sin(x(1) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(6)* ...
           (M4*MY4*cos(x(1) + x(3) + x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + ...
            2*L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + ...
            x(5)) - M4*MZ4*sin(x(1) + x(3) + x(5)) + M3*MY3*cos(x(1) + ...
            x(5)) + L3*M1*sin(x(1) + x(5)) + 2*L3*M3*sin(x(1) + x(5)) + L3* ...
           M4*sin(x(1) + x(5)) - M3*MZ3*sin(x(1) + x(5))))/(M1 + 2*M3 + 2* ...
           M4)) - x(10)*((x(8)*(M4*MY4*cos(x(1) + x(3) + x(5)) + L4*M1* ...
           sin(x(1) + x(3) + x(5)) + 2*L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4* ...
           M4*sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(1) + x(3) + ...
            x(5))))/(M1 + 2*M3 + 2*M4) + (x(10)*(M4*MY4*cos(x(1) + x(3) + ...
            x(5)) + M4*MY4*cos(x(2) + x(4) + x(5)) + L4*M1*sin(x(1) + x(3) + ...
            x(5)) + 2*L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4*M4*sin(x(1) + ...
            x(3) + x(5)) - M4*MZ4*sin(x(1) + x(3) + x(5)) - M4*MZ4* ...
           sin(x(2) + x(4) + x(5)) + M3*MY3*cos(x(1) + x(5)) + M3*MY3* ...
           cos(x(2) + x(5)) + L3*M1*sin(x(1) + x(5)) + 2*L3*M3*sin(x(1) + ...
            x(5)) + L3*M4*sin(x(1) + x(5)) - L3*M4*sin(x(2) + x(5)) - M3* ...
           MZ3*sin(x(1) + x(5)) - M3*MZ3*sin(x(2) + x(5)) + M1*MY1* ...
           cos(x(5)) - M1*MZ1*sin(x(5))))/(M1 + 2*M3 + 2*M4) + (x(6)*(M4* ...
           MY4*cos(x(1) + x(3) + x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2* ...
           L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - ...
            M4*MZ4*sin(x(1) + x(3) + x(5)) + M3*MY3*cos(x(1) + x(5)) + L3* ...
           M1*sin(x(1) + x(5)) + 2*L3*M3*sin(x(1) + x(5)) + L3*M4*sin(x(1) + ...
            x(5)) - M3*MZ3*sin(x(1) + x(5))))/(M1 + 2*M3 + 2*M4) - (x(7)* ...
           (M4*MZ4*sin(x(2) + x(4) + x(5)) - M4*MY4*cos(x(2) + x(4) + ...
            x(5)) - M3*MY3*cos(x(2) + x(5)) + L3*M4*sin(x(2) + x(5)) + M3* ...
           MZ3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(9)*(M4*MY4* ...
           cos(x(2) + x(4) + x(5)) - M4*MZ4*sin(x(2) + x(4) + x(5))))/(M1 + ...
            2*M3 + 2*M4)) - x(9)*((x(10)*(M4*MY4*cos(x(2) + x(4) + x(5)) - ...
            M4*MZ4*sin(x(2) + x(4) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(7)*(M4* ...
           MY4*cos(x(2) + x(4) + x(5)) - M4*MZ4*sin(x(2) + x(4) + ...
            x(5))))/(M1 + 2*M3 + 2*M4) + (x(9)*(M4*MY4*cos(x(2) + x(4) + ...
            x(5)) - M4*MZ4*sin(x(2) + x(4) + x(5))))/(M1 + 2*M3 + 2*M4)) - ...
            x(8)*((x(10)*(M4*MY4*cos(x(1) + x(3) + x(5)) + L4*M1*sin(x(1) + ...
            x(3) + x(5)) + 2*L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4*M4* ...
           sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(1) + x(3) + x(5))))/(M1 + ...
            2*M3 + 2*M4) + (x(6)*(M4*MY4*cos(x(1) + x(3) + x(5)) + L4*M1* ...
           sin(x(1) + x(3) + x(5)) + 2*L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4* ...
           M4*sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(1) + x(3) + ...
            x(5))))/(M1 + 2*M3 + 2*M4) + (x(8)*(M4*MY4*cos(x(1) + x(3) + ...
            x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2*L4*M3*sin(x(1) + ...
            x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - M4*MZ4* ...
           sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4)) + (ddq(1)*(L4*M1* ...
           cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4* ...
           M4*cos(x(1) + x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4* ...
           MY4*sin(x(1) + x(3) + x(5)) + L3*M1*cos(x(1) + x(5)) + 2*L3*M3* ...
           cos(x(1) + x(5)) + L3*M4*cos(x(1) + x(5)) - M3*MZ3*cos(x(1) + ...
            x(5)) - M3*MY3*sin(x(1) + x(5))))/(M1 + 2*M3 + 2*M4) - (ddq(2)* ...
           (M4*MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + x(4) + ...
            x(5)) + L3*M4*cos(x(2) + x(5)) + M3*MZ3*cos(x(2) + x(5)) + M3* ...
           MY3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) - (ddq(4)*(M4*MZ4* ...
           cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + x(4) + x(5))))/(M1 + ...
            2*M3 + 2*M4) - (ddq(5)*(M4*MZ4*cos(x(1) + x(3) + x(5)) - 2*L4* ...
           M3*cos(x(1) + x(3) + x(5)) - 2*L4*M4*cos(x(1) + x(3) + x(5)) - ...
            L4*M1*cos(x(1) + x(3) + x(5)) + M4*MZ4*cos(x(2) + x(4) + x(5)) + ...
            M4*MY4*sin(x(1) + x(3) + x(5)) + M4*MY4*sin(x(2) + x(4) + ...
            x(5)) - L3*M1*cos(x(1) + x(5)) - 2*L3*M3*cos(x(1) + x(5)) - L3* ...
           M4*cos(x(1) + x(5)) + L3*M4*cos(x(2) + x(5)) + M3*MZ3*cos(x(1) + ...
            x(5)) + M3*MZ3*cos(x(2) + x(5)) + M3*MY3*sin(x(1) + x(5)) + M3* ...
           MY3*sin(x(2) + x(5)) + M1*MZ1*cos(x(5)) + M1*MY1* ...
           sin(x(5))))/(M1 + 2*M3 + 2*M4) + (ddq(3)*(L4*M1*cos(x(1) + x(3) + ...
            x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4*M4*cos(x(1) + ...
            x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4*MY4* ...
           sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4);
    acmv = x(6)*((x(10)*(L4*M1*cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + ...
            x(3) + x(5)) + 2*L4*M4*cos(x(1) + x(3) + x(5)) - M4*MZ4* ...
           cos(x(1) + x(3) + x(5)) - M4*MY4*sin(x(1) + x(3) + x(5)) + L3*M1* ...
           cos(x(1) + x(5)) + 2*L3*M3*cos(x(1) + x(5)) + L3*M4*cos(x(1) + ...
            x(5)) - M3*MZ3*cos(x(1) + x(5)) - M3*MY3*sin(x(1) + ...
            x(5))))/(M1 + 2*M3 + 2*M4) + (x(6)*(L4*M1*cos(x(1) + x(3) + ...
            x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4*M4*cos(x(1) + ...
            x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4*MY4* ...
           sin(x(1) + x(3) + x(5)) + L3*M1*cos(x(1) + x(5)) + 2*L3*M3* ...
           cos(x(1) + x(5)) + L3*M4*cos(x(1) + x(5)) - M3*MZ3*cos(x(1) + ...
            x(5)) - M3*MY3*sin(x(1) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(8)* ...
           (L4*M1*cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + x(3) + ...
            x(5)) + 2*L4*M4*cos(x(1) + x(3) + x(5)) - M4*MZ4*cos(x(1) + ...
            x(3) + x(5)) - M4*MY4*sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2* ...
           M4)) - x(7)*((x(10)*(M4*MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4* ...
           sin(x(2) + x(4) + x(5)) + L3*M4*cos(x(2) + x(5)) + M3*MZ3* ...
           cos(x(2) + x(5)) + M3*MY3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) + ...
            (x(7)*(M4*MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + x(4) + ...
            x(5)) + L3*M4*cos(x(2) + x(5)) + M3*MZ3*cos(x(2) + x(5)) + M3* ...
           MY3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(9)*(M4*MZ4* ...
           cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + x(4) + x(5))))/(M1 + ...
            2*M3 + 2*M4)) - x(10)*((x(7)*(M4*MZ4*cos(x(2) + x(4) + x(5)) + ...
            M4*MY4*sin(x(2) + x(4) + x(5)) + L3*M4*cos(x(2) + x(5)) + M3* ...
           MZ3*cos(x(2) + x(5)) + M3*MY3*sin(x(2) + x(5))))/(M1 + 2*M3 + 2* ...
           M4) - (x(6)*(L4*M1*cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + ...
            x(3) + x(5)) + 2*L4*M4*cos(x(1) + x(3) + x(5)) - M4*MZ4* ...
           cos(x(1) + x(3) + x(5)) - M4*MY4*sin(x(1) + x(3) + x(5)) + L3*M1* ...
           cos(x(1) + x(5)) + 2*L3*M3*cos(x(1) + x(5)) + L3*M4*cos(x(1) + ...
            x(5)) - M3*MZ3*cos(x(1) + x(5)) - M3*MY3*sin(x(1) + ...
            x(5))))/(M1 + 2*M3 + 2*M4) + (x(9)*(M4*MZ4*cos(x(2) + x(4) + ...
            x(5)) + M4*MY4*sin(x(2) + x(4) + x(5))))/(M1 + 2*M3 + 2*M4) + ...
            (x(10)*(M4*MZ4*cos(x(1) + x(3) + x(5)) - 2*L4*M3*cos(x(1) + ...
            x(3) + x(5)) - 2*L4*M4*cos(x(1) + x(3) + x(5)) - L4*M1* ...
           cos(x(1) + x(3) + x(5)) + M4*MZ4*cos(x(2) + x(4) + x(5)) + M4* ...
           MY4*sin(x(1) + x(3) + x(5)) + M4*MY4*sin(x(2) + x(4) + x(5)) - ...
            L3*M1*cos(x(1) + x(5)) - 2*L3*M3*cos(x(1) + x(5)) - L3*M4* ...
           cos(x(1) + x(5)) + L3*M4*cos(x(2) + x(5)) + M3*MZ3*cos(x(1) + ...
            x(5)) + M3*MZ3*cos(x(2) + x(5)) + M3*MY3*sin(x(1) + x(5)) + M3* ...
           MY3*sin(x(2) + x(5)) + M1*MZ1*cos(x(5)) + M1*MY1* ...
           sin(x(5))))/(M1 + 2*M3 + 2*M4) - (x(8)*(L4*M1*cos(x(1) + x(3) + ...
            x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4*M4*cos(x(1) + ...
            x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4*MY4* ...
           sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4)) - x(9)*((x(10)*(M4* ...
           MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + x(4) + ...
            x(5))))/(M1 + 2*M3 + 2*M4) + (x(7)*(M4*MZ4*cos(x(2) + x(4) + ...
            x(5)) + M4*MY4*sin(x(2) + x(4) + x(5))))/(M1 + 2*M3 + 2*M4) + ...
            (x(9)*(M4*MZ4*cos(x(2) + x(4) + x(5)) + M4*MY4*sin(x(2) + x(4) + ...
            x(5))))/(M1 + 2*M3 + 2*M4)) + x(8)*((x(10)*(L4*M1*cos(x(1) + ...
            x(3) + x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4*M4* ...
           cos(x(1) + x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4* ...
           MY4*sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(6)*(L4*M1* ...
           cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4* ...
           M4*cos(x(1) + x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4* ...
           MY4*sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4) + (x(8)*(L4*M1* ...
           cos(x(1) + x(3) + x(5)) + 2*L4*M3*cos(x(1) + x(3) + x(5)) + 2*L4* ...
           M4*cos(x(1) + x(3) + x(5)) - M4*MZ4*cos(x(1) + x(3) + x(5)) - M4* ...
           MY4*sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4)) + (ddq(3)*(M4* ...
           MY4*cos(x(1) + x(3) + x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2* ...
           L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - ...
            M4*MZ4*sin(x(1) + x(3) + x(5))))/(M1 + 2*M3 + 2*M4) + (ddq(5)* ...
           (M4*MY4*cos(x(1) + x(3) + x(5)) + M4*MY4*cos(x(2) + x(4) + ...
            x(5)) + L4*M1*sin(x(1) + x(3) + x(5)) + 2*L4*M3*sin(x(1) + ...
            x(3) + x(5)) + 2*L4*M4*sin(x(1) + x(3) + x(5)) - M4*MZ4* ...
           sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(2) + x(4) + x(5)) + M3* ...
           MY3*cos(x(1) + x(5)) + M3*MY3*cos(x(2) + x(5)) + L3*M1*sin(x(1) + ...
            x(5)) + 2*L3*M3*sin(x(1) + x(5)) + L3*M4*sin(x(1) + x(5)) - L3* ...
           M4*sin(x(2) + x(5)) - M3*MZ3*sin(x(1) + x(5)) - M3*MZ3*sin(x(2) + ...
            x(5)) + M1*MY1*cos(x(5)) - M1*MZ1*sin(x(5))))/(M1 + 2*M3 + 2* ...
           M4) + (ddq(1)*(M4*MY4*cos(x(1) + x(3) + x(5)) + L4*M1*sin(x(1) + ...
            x(3) + x(5)) + 2*L4*M3*sin(x(1) + x(3) + x(5)) + 2*L4*M4* ...
           sin(x(1) + x(3) + x(5)) - M4*MZ4*sin(x(1) + x(3) + x(5)) + M3* ...
           MY3*cos(x(1) + x(5)) + L3*M1*sin(x(1) + x(5)) + 2*L3*M3* ...
           sin(x(1) + x(5)) + L3*M4*sin(x(1) + x(5)) - M3*MZ3*sin(x(1) + ...
            x(5))))/(M1 + 2*M3 + 2*M4) - (ddq(2)*(M4*MZ4*sin(x(2) + x(4) + ...
            x(5)) - M4*MY4*cos(x(2) + x(4) + x(5)) - M3*MY3*cos(x(2) + ...
            x(5)) + L3*M4*sin(x(2) + x(5)) + M3*MZ3*sin(x(2) + x(5))))/(M1 + ...
            2*M3 + 2*M4) + (ddq(4)*(M4*MY4*cos(x(2) + x(4) + x(5)) - M4*MZ4* ...
           sin(x(2) + x(4) + x(5))))/(M1 + 2*M3 + 2*M4);
  end
end
